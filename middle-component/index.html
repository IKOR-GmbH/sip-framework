<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="IKOR" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Middle Component - SIP Framework Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Middle Component";
        var mkdocs_page_input_path = "middle-component.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SIP Framework Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../archetype/">Archetype</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../core/">Core</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Middle Component</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#description">Description</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-use">How to use</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#unit-testing-with-sipmc">Unit testing with sipmc</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../integration-starter/">Integration Starter</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../starter-parent/">Starter Parent</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../test-kit/">Test Kit</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../framework_version_upgrade/">Framework Version Upgrade</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">Contribution Guidelines</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT/">Code Of Conduct</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/latest/index.html">JavaDoc Latest Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.4.0/index.html">JavaDoc 2.4.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.3.0/index.html">JavaDoc 2.3.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.2.0/index.html">JavaDoc 2.2.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.1.0/index.html">JavaDoc 2.1.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.0.2/index.html">JavaDoc 2.0.2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/2.0.0/index.html">JavaDoc 2.0.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../javadoc/1.0.0/index.html">JavaDoc 1.0.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="https://ikor.one/produkt/system-integration-platform">Find out more about IKOR</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="https://ikor.one/impressum/">Impressum</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SIP Framework Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Middle Component</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/IKOR-GmbH/sip-framework/edit/main/docs/middle-component.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ikor-sip-middle-component">IKOR SIP Middle Component<a class="headerlink" href="#ikor-sip-middle-component" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#ikor-sip-middle-component">IKOR SIP Middle Component</a><ul>
<li><a href="#description">Description</a></li>
<li><a href="#how-to-use">How to use</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#unit-testing-with-sipmc">Unit testing with sipmc</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>SIP middle component relates to the key SIP concept - splitting integration logic into submodules (connectors).
Combining connectors into one data flow is quite easy with Camel and can be done in many ways. However, if we
do it with one of Camel's existing component, we couldn't be sure if it represents connection between connectors or just
some intermediate routing within the single connector. If we (properly) use sipmc component,
it provides a clear functional and visual distinction between a connector's ending or beginning.
With it, adapter routes become more standardized and manageable.
Middle component is also a point of higher control over Apache Camel flow, as it provides a placeholder for future customizations
which will make it easier to bridge connectors in different ways, e.g. by using JMS broker implicitly if configured.</p>
<p>Middle component hides connecting technology and makes connection of two sub-systems abstract and simple. Current version
supports only in-memory connection channel implemented on top of Camel's SEDA component. It provides 1 to 1 and
publish-subscribe patterns and can support many channels in single adapter. Middle component can automatically determine
the number of consumers for a specific channel and autoconfigure itself accordingly, as a 1 to 1 or publish-subscribe connector.
In any case it will be autoconfigured with waitForTaskToComplete=always, meaning that it will wait for all asynchronous <br />
processors to finish before it continues route execution. </p>
<h2 id="how-to-use">How to use<a class="headerlink" href="#how-to-use" title="Permanent link">&para;</a></h2>
<p>Middle component is used like any other Camel component, but has a simple URI pattern:</p>
<pre class="highlight"><code>sipmc:channelName</code></pre>
<p>The channel name is an arbitrary String value, but it should relate to one integration topic, e.q. partner.
Multiple sipmc routes may exist with different channel names.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p><strong>1 to 1:</strong>
In this scenario response provided by "mock:output" should be propagated back to the caller - "mock:input"</p>
<pre class="highlight"><code class="language-java"> from("mock:input")
    .to("sipmc:foo");

 from("sipmc:foo")
    .to("mock:output");</code></pre>
<p><strong>Publish subscribe:</strong>
With publish-subscribe pattern the caller (mock-input) does not know how many consumers are registered. Middle component
makes sure the message is delivered to all of them. Notice that the URIs do not differ too much from the ones in
previous case.</p>
<pre class="highlight"><code class="language-java"> from("mock:input")
    .to("sipmc:foo");

from("sipmc:foo")
    .to("mock:output1");
from("sipmc:foo")
    .to("mock:output2");</code></pre>
<h2 id="unit-testing-with-sipmc">Unit testing with sipmc<a class="headerlink" href="#unit-testing-with-sipmc" title="Permanent link">&para;</a></h2>
<p>Middle Component, as any custom Camel component, should be mocked within unit tests which test and cover Camel routes.
Otherwise, running the test will run the route within Camel context without Middle component and test will fail running.</p>
<p>When doing Camel testing, if you use Camel's <code>CamelTestSupport</code> class, Middle component can be mocked by using 
AdwiceWith inside your test. Following code and methods within Advice can be used for mocking sipmc: </p>
<pre class="highlight"><code class="language-java">@Test
void test() throws Exception {
    // arrange
    AdviceWith.adviceWith(context.getRouteDefinitions().get(0), context, new AdviceWithRouteBuilder() {
        @Override
        public void configure() throws Exception {

            // replace sipmc consumer with mocking seda
            replaceFromWith("seda:mockConsumer");

            // replace sipmc producer with mocking seda
            weaveByToUri("sipmc:someChannel").replace().to("seda:mockProducer");
        }
    });

    context().start();
}</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../core/" class="btn btn-neutral float-left" title="Core"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../integration-starter/" class="btn btn-neutral float-right" title="Integration Starter">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>© Copyright 2021, <a href="https://ikor.one">IKOR GmbH</a> & contributors</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/IKOR-GmbH/sip-framework" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../core/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../integration-starter/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../javascript/javadoc_menu_dropdown.js" defer></script>
      <script src="../javascript/copy_to_clipboard.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
